# ========================================
# BACKEND ENVIRONMENT VARIABLES
# ========================================

# OpenAI API (required for agents)
OPENAI_API_KEY=sk-proj-your-api-key-here

# Supabase (required for authentication and database)
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_ANON_KEY=your-anon-key
SUPABASE_JWT_SECRET=your-jwt-secret

# Database (PRODUCTION-PARITY: use pgbouncer pooler on port 6543)
# This ensures local environment matches production exactly
# Port 6543 = pgbouncer pooler (transaction mode, no prepared statements)
# Port 5432 = direct connection (session mode, prepared statements OK)
#
# Docker: Use Supabase URL (híbrido)
# Local: Use localhost
DATABASE_URL=postgresql+asyncpg://postgres:password@db.your-project.supabase.co:5432/postgres

# Encryption (for SII passwords)
ENCRYPTION_KEY=your-32-byte-base64-encoded-key-here

# Environment
ENVIRONMENT=development

# CORS (comma-separated origins)
ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000,http://localhost:8000

# Kapso WhatsApp API (for WhatsApp Business integration)
KAPSO_API_TOKEN=your-kapso-api-token-here
KAPSO_API_BASE_URL=https://app.kapso.ai/api/v1
KAPSO_WEBHOOK_SECRET=your-webhook-secret-here

# ========================================
# REDIS CONFIGURATION
# ========================================
# Redis (for Celery task queue and caching)
#
# Local (sin Docker): redis://localhost:6379/0
# Docker: redis://redis:6379/0 (usa el nombre del servicio)
# Railway: ${{Redis.REDIS_URL}} (auto-configurado por Railway Plugin)
#
# IMPORTANTE:
# - docker-compose.yml override automático a redis://redis:6379/0
# - Railway usa variable de referencia del plugin
REDIS_URL=redis://localhost:6379/0

# ========================================
# CELERY CONFIGURATION (Opcional)
# ========================================
# Configuración adicional para Celery workers
CELERY_LOG_LEVEL=info
CELERY_CONCURRENCY=2
CELERY_MAX_TASKS_PER_CHILD=1000

# ========================================
# DOCKER CONFIGURATION
# ========================================
# Puerto para FastAPI
# Docker: 8000 (desarrollo) o 8080 (producción)
# Local: 8000
PORT=8000

# ========================================
# MONITORING (Opcional)
# ========================================
# Sentry for error tracking
# SENTRY_DSN=your-sentry-dsn-here

# ========================================
# NGROK (Development - Webhooks)
# ========================================
# Token de autenticación de ngrok
# Obtener de: https://dashboard.ngrok.com/get-started/your-authtoken
# NGROK_AUTHTOKEN=your-ngrok-authtoken-here

# ========================================
# CHATKIT MODE
# ========================================
# Modo de operación del sistema de agentes
# Opciones: "multi_agent" (default) | "unified" | "supervisor"
CHATKIT_MODE=multi_agent

# ========================================
# RAILWAY DEPLOYMENT (Production)
# ========================================
# Configuración específica para Railway
# Ver: backend/RAILWAY_SETUP.md y backend/.env.railway.example
#
# Diferencias con desarrollo local:
# - REDIS_URL: ${{Redis.REDIS_URL}} (referencia al plugin)
# - DATABASE_URL: Usar puerto 6543 (pgbouncer) en lugar de 5432
# - ENVIRONMENT: production
# - PORT: Auto-asignado por Railway (no configurar manualmente)
# - ALLOWED_ORIGINS: Agregar dominio de producción
#
# Setup Railway:
# 1. Crear proyecto en Railway y conectar GitHub
# 2. Agregar Redis Plugin (Railway Dashboard > "+ New" > "Redis")
# 3. Crear 4 servicios: backend, celery-worker, celery-beat, flower
# 4. Configurar variables compartidas (Railway Dashboard > Settings > Variables)
# 5. Deploy automático con push a GitHub
#
# Servicios Railway:
# - backend: FastAPI + Gunicorn (puerto público)
# - celery-worker: Procesamiento de tareas asíncronas
# - celery-beat: Scheduler de tareas programadas
# - flower: UI de monitoring para Celery
#
# Costos estimados: ~$23/mes (Hobby plan)
#
# Para guía completa: backend/RAILWAY_SETUP.md
# Para guía express: backend/RAILWAY_QUICKSTART.md
